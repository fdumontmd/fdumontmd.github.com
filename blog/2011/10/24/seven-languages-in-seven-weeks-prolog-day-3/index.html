
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Seven Languages in Seven Weeks Prolog Day 3 - Wakatta!</title>
  <meta name="author" content="Frédéric Dumont">

  
  <meta name="description" content="The final day with Prolog is called &#8220;Blowing Up Vegas&#8221; in the book, and was certainly intended as a Shock and Awe moment. Unfortunately, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.wakatta.jp/blog/2011/10/24/seven-languages-in-seven-weeks-prolog-day-3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Wakatta!" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26245052-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Wakatta!</a></h1>
  
    <h2>Like Eureka!, only cooler</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.wakatta.jp" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Seven Languages in Seven Weeks Prolog Day 3</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-24T13:33:00+09:00" pubdate data-updated="true">Oct 24<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>The final day with Prolog is called &#8220;Blowing Up Vegas&#8221; in the book, and was certainly intended as a Shock and Awe moment. Unfortunately, it feels more like Razzle Dazzle.</p>

<!--more-->


<p>Certainly, the code for both solvers (8 Queens and Sudoku) is short (if slightly incomplete) and effective. But it has one, significant shortcoming: it is not Prolog code.</p>

<p>Prolog&#8217;s main control mechanism, backtracking, means the language is a natural match for problems that can be expressed as searches. But to be efficient, it is important to pay attention to the shape of the tree that is defined by the rules. Cutting and pruning are critical to ensure that Prolog will answer quickly (that is, before the Sun blows up or the Universe cools down).</p>

<p>As I was looking at the code for Day 3, I was specifically looking for the code that would shape the search tree; there were a couple of predicates (<code>fd_domain</code>, <code>fd_all_different</code>) which I didn&#8217;t know about, so I mentally replaced them with code whose meaning was derived from the names of the unknown predicates (so <code>fd_domain</code> would try to assign a value between 1 and the passed maximum to each variables in the passed list, while <code>fd_all_different</code> would ensure that all values in the passed list was indeed different). The explanation in the book supported this interpretation.</p>

<p>Now, my problem was that the code as I understood it would be terribly slow: the <code>fd_domain</code> would generate a lot of different solutions, and <code>fd_all_different</code> would invalidate all but a few. Certainly, I was thinking, the 9x9 Sudoku will never work, even if the 4x4 seems to.</p>

<p>So I was surprised when I ran the 9x9 Sudoku (see below for the code): it was really fast. My assumptions regarding the unknown predicates were all wrong. Time to look at the <a href="http://www.gprolog.org/manual/html_node/gprolog055.html">manual</a>. It turns out that these predicates below to a specific GNU Prolog library (so it is not portable) designed to solve <a href="http://en.wikipedia.org/wiki/Constraint_logic_programming">Finite Domain</a> problems. Now, clearly, this is a great library, it simplifies things a lot. But there&#8217;s also the problem: what is so great about today&#8217;s code is due to the library, not specifically to Prolog. Many languages have such a library, so the case for Prolog is kind of weakened.</p>

<p>Before I finally understood the role of the finite domain solver in today&#8217;s code, I had reimplemented the 8 Queens (generalized to N Queens) with explicit search tree pruning. So here I will show variants of the book code, which I hope will be better witnesses to Prolog&#8217;s strengths.</p>

<h2>Exercises</h2>

<p>As stated above, I will depart considerably from the exercises, although the ones mentioned in the book are all here.</p>

<h3>Input/Ouput</h3>

<p>There are a number of such predicates, listed <a href="http://www.gprolog.org/manual/html_node/gprolog038.html#toc126">here</a>.</p>

<h3>Print only successful solutions</h3>

<p>I must say I&#8217;m not sure I understand this one. My approach is always to organise clauses so that the printing occurs last, when solutions are fully known. See below the code for the solvers.</p>

<h3>9x9 Sudoku Solver</h3>

<p>A first thing: when using GNU Prolog&#8217;s Finite Domain Solver, the variables must be assigned a label from the domain, using <code>fd_labeling</code>. Otherwise, solutions will be displayed with a superset of the possible values for each unknown, rather than just the possible ones.</p>

<figure class='code'><figcaption><span>9x9 Sudoku Solver  (sudoku_book.pl)</span> <a href='/downloads/code/7l7w/prolog/sudoku_book.pl'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="nf">sudoku</span><span class="p">(</span><span class="nv">Puzzle</span><span class="p">,</span> <span class="nv">Solution</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nv">Solution</span> <span class="o">=</span> <span class="nv">Puzzle</span><span class="p">,</span>
</span><span class='line'>    <span class="nv">Puzzle</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S11</span><span class="p">,</span> <span class="nv">S12</span><span class="p">,</span> <span class="nv">S13</span><span class="p">,</span> <span class="nv">S14</span><span class="p">,</span> <span class="nv">S15</span><span class="p">,</span> <span class="nv">S16</span><span class="p">,</span> <span class="nv">S17</span><span class="p">,</span> <span class="nv">S18</span><span class="p">,</span> <span class="nv">S19</span><span class="p">,</span>
</span><span class='line'>              <span class="nv">S21</span><span class="p">,</span> <span class="nv">S22</span><span class="p">,</span> <span class="nv">S23</span><span class="p">,</span> <span class="nv">S24</span><span class="p">,</span> <span class="nv">S25</span><span class="p">,</span> <span class="nv">S26</span><span class="p">,</span> <span class="nv">S27</span><span class="p">,</span> <span class="nv">S28</span><span class="p">,</span> <span class="nv">S29</span><span class="p">,</span>
</span><span class='line'>              <span class="nv">S31</span><span class="p">,</span> <span class="nv">S32</span><span class="p">,</span> <span class="nv">S33</span><span class="p">,</span> <span class="nv">S34</span><span class="p">,</span> <span class="nv">S35</span><span class="p">,</span> <span class="nv">S36</span><span class="p">,</span> <span class="nv">S37</span><span class="p">,</span> <span class="nv">S38</span><span class="p">,</span> <span class="nv">S39</span><span class="p">,</span>
</span><span class='line'>              <span class="nv">S41</span><span class="p">,</span> <span class="nv">S42</span><span class="p">,</span> <span class="nv">S43</span><span class="p">,</span> <span class="nv">S44</span><span class="p">,</span> <span class="nv">S45</span><span class="p">,</span> <span class="nv">S46</span><span class="p">,</span> <span class="nv">S47</span><span class="p">,</span> <span class="nv">S48</span><span class="p">,</span> <span class="nv">S49</span><span class="p">,</span>
</span><span class='line'>              <span class="nv">S51</span><span class="p">,</span> <span class="nv">S52</span><span class="p">,</span> <span class="nv">S53</span><span class="p">,</span> <span class="nv">S54</span><span class="p">,</span> <span class="nv">S55</span><span class="p">,</span> <span class="nv">S56</span><span class="p">,</span> <span class="nv">S57</span><span class="p">,</span> <span class="nv">S58</span><span class="p">,</span> <span class="nv">S59</span><span class="p">,</span>
</span><span class='line'>              <span class="nv">S61</span><span class="p">,</span> <span class="nv">S62</span><span class="p">,</span> <span class="nv">S63</span><span class="p">,</span> <span class="nv">S64</span><span class="p">,</span> <span class="nv">S65</span><span class="p">,</span> <span class="nv">S66</span><span class="p">,</span> <span class="nv">S67</span><span class="p">,</span> <span class="nv">S68</span><span class="p">,</span> <span class="nv">S69</span><span class="p">,</span>
</span><span class='line'>              <span class="nv">S71</span><span class="p">,</span> <span class="nv">S72</span><span class="p">,</span> <span class="nv">S73</span><span class="p">,</span> <span class="nv">S74</span><span class="p">,</span> <span class="nv">S75</span><span class="p">,</span> <span class="nv">S76</span><span class="p">,</span> <span class="nv">S77</span><span class="p">,</span> <span class="nv">S78</span><span class="p">,</span> <span class="nv">S79</span><span class="p">,</span>
</span><span class='line'>              <span class="nv">S81</span><span class="p">,</span> <span class="nv">S82</span><span class="p">,</span> <span class="nv">S83</span><span class="p">,</span> <span class="nv">S84</span><span class="p">,</span> <span class="nv">S85</span><span class="p">,</span> <span class="nv">S86</span><span class="p">,</span> <span class="nv">S87</span><span class="p">,</span> <span class="nv">S88</span><span class="p">,</span> <span class="nv">S89</span><span class="p">,</span>
</span><span class='line'>              <span class="nv">S91</span><span class="p">,</span> <span class="nv">S92</span><span class="p">,</span> <span class="nv">S93</span><span class="p">,</span> <span class="nv">S94</span><span class="p">,</span> <span class="nv">S95</span><span class="p">,</span> <span class="nv">S96</span><span class="p">,</span> <span class="nv">S97</span><span class="p">,</span> <span class="nv">S98</span><span class="p">,</span> <span class="nv">S99</span><span class="p">],</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">fd_domain</span><span class="p">(</span><span class="nv">Puzzle</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">),</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">Col1</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S11</span><span class="p">,</span> <span class="nv">S21</span><span class="p">,</span> <span class="nv">S31</span><span class="p">,</span> <span class="nv">S41</span><span class="p">,</span> <span class="nv">S51</span><span class="p">,</span> <span class="nv">S61</span><span class="p">,</span> <span class="nv">S71</span><span class="p">,</span> <span class="nv">S81</span><span class="p">,</span> <span class="nv">S91</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Col2</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S12</span><span class="p">,</span> <span class="nv">S22</span><span class="p">,</span> <span class="nv">S32</span><span class="p">,</span> <span class="nv">S42</span><span class="p">,</span> <span class="nv">S52</span><span class="p">,</span> <span class="nv">S62</span><span class="p">,</span> <span class="nv">S72</span><span class="p">,</span> <span class="nv">S82</span><span class="p">,</span> <span class="nv">S92</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Col3</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S13</span><span class="p">,</span> <span class="nv">S23</span><span class="p">,</span> <span class="nv">S33</span><span class="p">,</span> <span class="nv">S43</span><span class="p">,</span> <span class="nv">S53</span><span class="p">,</span> <span class="nv">S63</span><span class="p">,</span> <span class="nv">S73</span><span class="p">,</span> <span class="nv">S83</span><span class="p">,</span> <span class="nv">S93</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Col4</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S14</span><span class="p">,</span> <span class="nv">S24</span><span class="p">,</span> <span class="nv">S34</span><span class="p">,</span> <span class="nv">S44</span><span class="p">,</span> <span class="nv">S54</span><span class="p">,</span> <span class="nv">S64</span><span class="p">,</span> <span class="nv">S74</span><span class="p">,</span> <span class="nv">S84</span><span class="p">,</span> <span class="nv">S94</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Col5</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S15</span><span class="p">,</span> <span class="nv">S25</span><span class="p">,</span> <span class="nv">S35</span><span class="p">,</span> <span class="nv">S45</span><span class="p">,</span> <span class="nv">S55</span><span class="p">,</span> <span class="nv">S65</span><span class="p">,</span> <span class="nv">S75</span><span class="p">,</span> <span class="nv">S85</span><span class="p">,</span> <span class="nv">S95</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Col6</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S16</span><span class="p">,</span> <span class="nv">S26</span><span class="p">,</span> <span class="nv">S36</span><span class="p">,</span> <span class="nv">S46</span><span class="p">,</span> <span class="nv">S56</span><span class="p">,</span> <span class="nv">S66</span><span class="p">,</span> <span class="nv">S76</span><span class="p">,</span> <span class="nv">S86</span><span class="p">,</span> <span class="nv">S96</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Col7</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S17</span><span class="p">,</span> <span class="nv">S27</span><span class="p">,</span> <span class="nv">S37</span><span class="p">,</span> <span class="nv">S47</span><span class="p">,</span> <span class="nv">S57</span><span class="p">,</span> <span class="nv">S67</span><span class="p">,</span> <span class="nv">S77</span><span class="p">,</span> <span class="nv">S87</span><span class="p">,</span> <span class="nv">S97</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Col8</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S18</span><span class="p">,</span> <span class="nv">S28</span><span class="p">,</span> <span class="nv">S38</span><span class="p">,</span> <span class="nv">S48</span><span class="p">,</span> <span class="nv">S58</span><span class="p">,</span> <span class="nv">S68</span><span class="p">,</span> <span class="nv">S78</span><span class="p">,</span> <span class="nv">S88</span><span class="p">,</span> <span class="nv">S98</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Col9</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S19</span><span class="p">,</span> <span class="nv">S29</span><span class="p">,</span> <span class="nv">S39</span><span class="p">,</span> <span class="nv">S49</span><span class="p">,</span> <span class="nv">S59</span><span class="p">,</span> <span class="nv">S69</span><span class="p">,</span> <span class="nv">S79</span><span class="p">,</span> <span class="nv">S89</span><span class="p">,</span> <span class="nv">S99</span><span class="p">],</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">Row1</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S11</span><span class="p">,</span> <span class="nv">S12</span><span class="p">,</span> <span class="nv">S13</span><span class="p">,</span> <span class="nv">S14</span><span class="p">,</span> <span class="nv">S15</span><span class="p">,</span> <span class="nv">S16</span><span class="p">,</span> <span class="nv">S17</span><span class="p">,</span> <span class="nv">S18</span><span class="p">,</span> <span class="nv">S19</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Row2</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S21</span><span class="p">,</span> <span class="nv">S22</span><span class="p">,</span> <span class="nv">S23</span><span class="p">,</span> <span class="nv">S24</span><span class="p">,</span> <span class="nv">S25</span><span class="p">,</span> <span class="nv">S26</span><span class="p">,</span> <span class="nv">S27</span><span class="p">,</span> <span class="nv">S28</span><span class="p">,</span> <span class="nv">S29</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Row3</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S31</span><span class="p">,</span> <span class="nv">S32</span><span class="p">,</span> <span class="nv">S33</span><span class="p">,</span> <span class="nv">S34</span><span class="p">,</span> <span class="nv">S35</span><span class="p">,</span> <span class="nv">S36</span><span class="p">,</span> <span class="nv">S37</span><span class="p">,</span> <span class="nv">S38</span><span class="p">,</span> <span class="nv">S39</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Row4</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S41</span><span class="p">,</span> <span class="nv">S42</span><span class="p">,</span> <span class="nv">S43</span><span class="p">,</span> <span class="nv">S44</span><span class="p">,</span> <span class="nv">S45</span><span class="p">,</span> <span class="nv">S46</span><span class="p">,</span> <span class="nv">S47</span><span class="p">,</span> <span class="nv">S48</span><span class="p">,</span> <span class="nv">S49</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Row5</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S51</span><span class="p">,</span> <span class="nv">S52</span><span class="p">,</span> <span class="nv">S53</span><span class="p">,</span> <span class="nv">S54</span><span class="p">,</span> <span class="nv">S55</span><span class="p">,</span> <span class="nv">S56</span><span class="p">,</span> <span class="nv">S57</span><span class="p">,</span> <span class="nv">S58</span><span class="p">,</span> <span class="nv">S59</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Row6</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S61</span><span class="p">,</span> <span class="nv">S62</span><span class="p">,</span> <span class="nv">S63</span><span class="p">,</span> <span class="nv">S64</span><span class="p">,</span> <span class="nv">S65</span><span class="p">,</span> <span class="nv">S66</span><span class="p">,</span> <span class="nv">S67</span><span class="p">,</span> <span class="nv">S68</span><span class="p">,</span> <span class="nv">S69</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Row7</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S71</span><span class="p">,</span> <span class="nv">S72</span><span class="p">,</span> <span class="nv">S73</span><span class="p">,</span> <span class="nv">S74</span><span class="p">,</span> <span class="nv">S75</span><span class="p">,</span> <span class="nv">S76</span><span class="p">,</span> <span class="nv">S77</span><span class="p">,</span> <span class="nv">S78</span><span class="p">,</span> <span class="nv">S79</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Row8</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S81</span><span class="p">,</span> <span class="nv">S82</span><span class="p">,</span> <span class="nv">S83</span><span class="p">,</span> <span class="nv">S84</span><span class="p">,</span> <span class="nv">S85</span><span class="p">,</span> <span class="nv">S86</span><span class="p">,</span> <span class="nv">S87</span><span class="p">,</span> <span class="nv">S88</span><span class="p">,</span> <span class="nv">S89</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Row9</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S91</span><span class="p">,</span> <span class="nv">S92</span><span class="p">,</span> <span class="nv">S93</span><span class="p">,</span> <span class="nv">S94</span><span class="p">,</span> <span class="nv">S95</span><span class="p">,</span> <span class="nv">S96</span><span class="p">,</span> <span class="nv">S97</span><span class="p">,</span> <span class="nv">S98</span><span class="p">,</span> <span class="nv">S99</span><span class="p">],</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">Square1</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S11</span><span class="p">,</span> <span class="nv">S21</span><span class="p">,</span> <span class="nv">S31</span><span class="p">,</span> <span class="nv">S12</span><span class="p">,</span> <span class="nv">S22</span><span class="p">,</span> <span class="nv">S32</span><span class="p">,</span> <span class="nv">S13</span><span class="p">,</span> <span class="nv">S23</span><span class="p">,</span> <span class="nv">S33</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Square2</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S41</span><span class="p">,</span> <span class="nv">S51</span><span class="p">,</span> <span class="nv">S61</span><span class="p">,</span> <span class="nv">S42</span><span class="p">,</span> <span class="nv">S52</span><span class="p">,</span> <span class="nv">S62</span><span class="p">,</span> <span class="nv">S43</span><span class="p">,</span> <span class="nv">S53</span><span class="p">,</span> <span class="nv">S63</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Square3</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S71</span><span class="p">,</span> <span class="nv">S81</span><span class="p">,</span> <span class="nv">S91</span><span class="p">,</span> <span class="nv">S72</span><span class="p">,</span> <span class="nv">S82</span><span class="p">,</span> <span class="nv">S92</span><span class="p">,</span> <span class="nv">S73</span><span class="p">,</span> <span class="nv">S83</span><span class="p">,</span> <span class="nv">S93</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Square4</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S14</span><span class="p">,</span> <span class="nv">S24</span><span class="p">,</span> <span class="nv">S34</span><span class="p">,</span> <span class="nv">S15</span><span class="p">,</span> <span class="nv">S25</span><span class="p">,</span> <span class="nv">S35</span><span class="p">,</span> <span class="nv">S16</span><span class="p">,</span> <span class="nv">S26</span><span class="p">,</span> <span class="nv">S36</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Square5</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S44</span><span class="p">,</span> <span class="nv">S54</span><span class="p">,</span> <span class="nv">S64</span><span class="p">,</span> <span class="nv">S45</span><span class="p">,</span> <span class="nv">S55</span><span class="p">,</span> <span class="nv">S65</span><span class="p">,</span> <span class="nv">S46</span><span class="p">,</span> <span class="nv">S56</span><span class="p">,</span> <span class="nv">S66</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Square6</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S74</span><span class="p">,</span> <span class="nv">S84</span><span class="p">,</span> <span class="nv">S94</span><span class="p">,</span> <span class="nv">S75</span><span class="p">,</span> <span class="nv">S85</span><span class="p">,</span> <span class="nv">S95</span><span class="p">,</span> <span class="nv">S76</span><span class="p">,</span> <span class="nv">S86</span><span class="p">,</span> <span class="nv">S96</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Square7</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S17</span><span class="p">,</span> <span class="nv">S27</span><span class="p">,</span> <span class="nv">S37</span><span class="p">,</span> <span class="nv">S18</span><span class="p">,</span> <span class="nv">S28</span><span class="p">,</span> <span class="nv">S38</span><span class="p">,</span> <span class="nv">S19</span><span class="p">,</span> <span class="nv">S29</span><span class="p">,</span> <span class="nv">S39</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Square8</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S47</span><span class="p">,</span> <span class="nv">S57</span><span class="p">,</span> <span class="nv">S67</span><span class="p">,</span> <span class="nv">S48</span><span class="p">,</span> <span class="nv">S58</span><span class="p">,</span> <span class="nv">S68</span><span class="p">,</span> <span class="nv">S49</span><span class="p">,</span> <span class="nv">S59</span><span class="p">,</span> <span class="nv">S69</span><span class="p">],</span>
</span><span class='line'>    <span class="nv">Square9</span> <span class="o">=</span> <span class="p">[</span><span class="nv">S77</span><span class="p">,</span> <span class="nv">S87</span><span class="p">,</span> <span class="nv">S97</span><span class="p">,</span> <span class="nv">S78</span><span class="p">,</span> <span class="nv">S88</span><span class="p">,</span> <span class="nv">S98</span><span class="p">,</span> <span class="nv">S79</span><span class="p">,</span> <span class="nv">S89</span><span class="p">,</span> <span class="nv">S99</span><span class="p">],</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">valid</span><span class="p">([</span><span class="nv">Row1</span><span class="p">,</span> <span class="nv">Row2</span><span class="p">,</span> <span class="nv">Row3</span><span class="p">,</span> <span class="nv">Row4</span><span class="p">,</span> <span class="nv">Row5</span><span class="p">,</span> <span class="nv">Row6</span><span class="p">,</span> <span class="nv">Row7</span><span class="p">,</span> <span class="nv">Row8</span><span class="p">,</span> <span class="nv">Row9</span><span class="p">,</span>
</span><span class='line'>           <span class="nv">Col1</span><span class="p">,</span> <span class="nv">Col2</span><span class="p">,</span> <span class="nv">Col3</span><span class="p">,</span> <span class="nv">Col4</span><span class="p">,</span> <span class="nv">Col5</span><span class="p">,</span> <span class="nv">Col6</span><span class="p">,</span> <span class="nv">Col7</span><span class="p">,</span> <span class="nv">Col8</span><span class="p">,</span> <span class="nv">Col9</span><span class="p">,</span>
</span><span class='line'>           <span class="nv">Square1</span><span class="p">,</span> <span class="nv">Square2</span><span class="p">,</span> <span class="nv">Square3</span><span class="p">,</span> <span class="nv">Square4</span><span class="p">,</span> <span class="nv">Square5</span><span class="p">,</span>
</span><span class='line'>           <span class="nv">Square6</span><span class="p">,</span> <span class="nv">Square7</span><span class="p">,</span> <span class="nv">Square8</span><span class="p">,</span> <span class="nv">Square9</span><span class="p">]),</span>
</span><span class='line'>    <span class="nf">fd_labeling</span><span class="p">(</span><span class="nv">Puzzle</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">valid</span><span class="p">([]).</span>
</span><span class='line'><span class="nf">valid</span><span class="p">([</span><span class="nv">Head</span><span class="p">|</span><span class="nv">Tail</span><span class="p">])</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">fd_all_different</span><span class="p">(</span><span class="nv">Head</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">valid</span><span class="p">(</span><span class="nv">Tail</span><span class="p">).</span>
</span></code></pre></td></tr></table></div></figure>


<p>This was clearly tedious to write (I wrote a few Emacs functions to do the job). I will show a better (I think) way below.</p>

<figure class='code'><figcaption><span>Sudoko test  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">sudoku</span><span class="p">([</span><span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span>
</span><span class='line'>        <span class="m">3</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="m">5</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span>
</span><span class='line'>        <span class="m">4</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">],</span>
</span><span class='line'>       <span class="nv">Solution</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Solution</span> <span class="o">=</span> <span class="p">[</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">]</span> <span class="s-Atom">?</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note: I found a few implementations missing the <code>fd_labeling</code> clause, which causes the test above to return:</p>

<figure class='code'><figcaption><span>Sudoko test without fd_labeling  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">sudoku</span><span class="p">([</span><span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span>
</span><span class='line'>        <span class="m">3</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="m">5</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span>
</span><span class='line'>        <span class="m">4</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">],</span>
</span><span class='line'>       <span class="nv">Solution</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Solution</span> <span class="o">=</span> <span class="p">[</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">3</span><span class="p">(</span><span class="m">8</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">25</span><span class="p">(</span><span class="m">4</span><span class="p">..</span><span class="m">5</span><span class="s-Atom">:</span><span class="m">8</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">47</span><span class="p">(</span><span class="m">4</span><span class="p">..</span><span class="m">5</span><span class="s-Atom">:</span><span class="m">8</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="m">2</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">83</span><span class="p">(</span><span class="m">1</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">8</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">105</span><span class="p">(</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">),</span><span class="m">7</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">191</span><span class="p">(</span><span class="m">6</span><span class="s-Atom">:</span><span class="m">8</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">213</span><span class="p">(</span><span class="m">7</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">235</span><span class="p">(</span><span class="m">6</span><span class="s-Atom">:</span><span class="m">8</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">257</span><span class="p">(</span><span class="m">6</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">343</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">..</span><span class="m">7</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">365</span><span class="p">(</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">),</span><span class="m">1</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">401</span><span class="p">(</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">423</span><span class="p">(</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">..</span><span class="m">7</span><span class="p">),</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">509</span><span class="p">(</span><span class="m">1</span><span class="p">..</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">..</span><span class="m">8</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">531</span><span class="p">(</span><span class="m">1</span><span class="s-Atom">:</span><span class="m">4</span><span class="p">..</span><span class="m">6</span><span class="s-Atom">:</span><span class="m">8</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">553</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">4</span><span class="p">..</span><span class="m">5</span><span class="s-Atom">:</span><span class="m">7</span><span class="p">..</span><span class="m">8</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">575</span><span class="p">(</span><span class="m">1</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">597</span><span class="p">(</span><span class="m">1</span><span class="p">..</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">..</span><span class="m">7</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">619</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">..</span><span class="m">7</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">641</span><span class="p">(</span><span class="m">1</span><span class="p">..</span><span class="m">3</span><span class="s-Atom">:</span><span class="m">6</span><span class="s-Atom">:</span><span class="m">8</span><span class="p">),</span><span class="m">9</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">677</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">..</span><span class="m">7</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">699</span><span class="p">(</span><span class="m">1</span><span class="p">..</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">..</span><span class="m">7</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">721</span><span class="p">(</span><span class="m">1</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">743</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">7</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">),</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">807</span><span class="p">(</span><span class="m">1</span><span class="p">..</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">829</span><span class="p">(</span><span class="m">1</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">7</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">851</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">..</span><span class="m">7</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">873</span><span class="p">(</span><span class="m">1</span><span class="p">..</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="m">3</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">909</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">4</span><span class="p">..</span><span class="m">5</span><span class="s-Atom">:</span><span class="m">7</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">931</span><span class="p">(</span><span class="m">1</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">953</span><span class="p">(</span><span class="m">1</span><span class="p">..</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">..</span><span class="m">7</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">975</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">..</span><span class="m">7</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">997</span><span class="p">(</span><span class="m">1</span><span class="p">..</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">6</span><span class="s-Atom">:</span><span class="m">8</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1019</span><span class="p">(</span><span class="m">1</span><span class="s-Atom">:</span><span class="m">4</span><span class="p">..</span><span class="m">5</span><span class="s-Atom">:</span><span class="m">7</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1041</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">..</span><span class="m">7</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1063</span><span class="p">(</span><span class="m">1</span><span class="s-Atom">:</span><span class="m">8</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1127</span><span class="p">(</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">8</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1149</span><span class="p">(</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">),</span><span class="m">5</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1185</span><span class="p">(</span><span class="m">1</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">7</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1207</span><span class="p">(</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">7</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">),</span><span class="m">5</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1243</span><span class="p">(</span><span class="m">1</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">),</span><span class="m">3</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1293</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1315</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">4</span><span class="s-Atom">:</span><span class="m">6</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1337</span><span class="p">(</span><span class="m">1</span><span class="p">..</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1359</span><span class="p">(</span><span class="m">1</span><span class="s-Atom">:</span><span class="m">4</span><span class="p">),</span><span class="m">8</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1423</span><span class="p">(</span><span class="m">8</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1445</span><span class="p">(</span><span class="m">6</span><span class="s-Atom">:</span><span class="m">8</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1467</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">5</span><span class="p">..</span><span class="m">6</span><span class="s-Atom">:</span><span class="m">8</span><span class="p">..</span><span class="m">9</span><span class="p">),</span><span class="m">1</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1503</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">6</span><span class="p">),</span><span class="m">3</span><span class="p">,</span><span class="k">_</span><span class="s-Atom">#</span><span class="m">1547</span><span class="p">(</span><span class="m">2</span><span class="s-Atom">:</span><span class="m">6</span><span class="s-Atom">:</span><span class="m">9</span><span class="p">)]</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="m">1</span> <span class="s-Atom">ms</span><span class="p">)</span> <span class="s-Atom">yes</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Utility predicates</h3>

<p>First, I need to introduce a few helper predicates which will come handy later on.</p>

<figure class='code'><figcaption><span>Utility predicates  (utils.pl)</span> <a href='/downloads/code/7l7w/prolog/utils.pl'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="c1">% apply a clause to each element of a list, and collect the results</span>
</span><span class='line'><span class="nf">maplist</span><span class="p">(</span><span class="k">_</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]).</span>
</span><span class='line'><span class="nf">maplist</span><span class="p">(</span><span class="nv">P</span><span class="p">,</span> <span class="p">[</span><span class="nv">H</span><span class="p">|</span><span class="nv">T</span><span class="p">],</span> <span class="p">[</span><span class="nv">R</span><span class="p">|</span><span class="nv">Rs</span><span class="p">])</span> <span class="p">:-</span> <span class="nf">call</span><span class="p">(</span><span class="nv">P</span><span class="p">,</span> <span class="nv">H</span><span class="p">,</span> <span class="nv">R</span><span class="p">),</span> <span class="nf">maplist</span><span class="p">(</span><span class="nv">P</span><span class="p">,</span> <span class="nv">T</span><span class="p">,</span> <span class="nv">Rs</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% same, but without return value - only side effect</span>
</span><span class='line'><span class="nf">maplist_</span><span class="p">(</span><span class="k">_</span><span class="p">,</span> <span class="p">[]).</span>
</span><span class='line'><span class="nf">maplist_</span><span class="p">(</span><span class="nv">P</span><span class="p">,</span> <span class="p">[</span><span class="nv">H</span><span class="p">|</span><span class="nv">T</span><span class="p">])</span> <span class="p">:-</span> <span class="nf">call</span><span class="p">(</span><span class="nv">P</span><span class="p">,</span> <span class="nv">H</span><span class="p">),</span> <span class="nf">maplist_</span><span class="p">(</span><span class="nv">P</span><span class="p">,</span> <span class="nv">T</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% same as maplist, but passes the current index to the predicate</span>
</span><span class='line'><span class="nf">maplistidx</span><span class="p">(</span><span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]).</span>
</span><span class='line'><span class="nf">maplistidx</span><span class="p">(</span><span class="nv">Pred</span><span class="p">,</span> <span class="nv">N</span><span class="p">,</span> <span class="p">[</span><span class="nv">H</span><span class="p">|</span><span class="nv">T</span><span class="p">],</span> <span class="p">[</span><span class="nv">X</span><span class="p">|</span><span class="nv">R</span><span class="p">])</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">call</span><span class="p">(</span><span class="nv">Pred</span><span class="p">,</span> <span class="nv">N</span><span class="p">,</span> <span class="nv">H</span><span class="p">,</span> <span class="nv">X</span><span class="p">),</span>
</span><span class='line'>    <span class="nv">N1</span> <span class="o">is</span> <span class="nv">N</span> <span class="o">+</span> <span class="m">1</span><span class="p">,</span>
</span><span class='line'>    <span class="nf">maplistidx</span><span class="p">(</span><span class="nv">Pred</span><span class="p">,</span> <span class="nv">N1</span><span class="p">,</span> <span class="nv">T</span><span class="p">,</span> <span class="nv">R</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% subtract(S, Es, R) deletes all elements in Es from S, and puts the result in R</span>
</span><span class='line'><span class="nf">subtract</span><span class="p">(</span><span class="nv">Set</span><span class="p">,</span> <span class="p">[],</span> <span class="nv">Set</span><span class="p">).</span>
</span><span class='line'><span class="nf">subtract</span><span class="p">(</span><span class="nv">Set</span><span class="p">,</span> <span class="p">[</span><span class="nv">H</span><span class="p">|</span><span class="nv">T</span><span class="p">],</span> <span class="nv">Result</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">delete</span><span class="p">(</span><span class="nv">Set</span><span class="p">,</span> <span class="nv">H</span><span class="p">,</span> <span class="nv">R1</span><span class="p">),</span> <span class="nf">subtract</span><span class="p">(</span><span class="nv">R1</span><span class="p">,</span> <span class="nv">T</span><span class="p">,</span> <span class="nv">Result</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% Matrix transposition. A Matrix is a list of list</span>
</span><span class='line'><span class="nf">transpose</span><span class="p">([],</span> <span class="p">[]).</span>
</span><span class='line'><span class="nf">transpose</span><span class="p">([[]|</span><span class="k">_</span><span class="p">],</span> <span class="p">[]).</span>
</span><span class='line'><span class="nf">transpose</span><span class="p">(</span><span class="nv">M</span><span class="p">,</span> <span class="p">[</span><span class="nv">Hs</span><span class="p">|</span><span class="nv">M1</span><span class="p">])</span> <span class="p">:-</span> <span class="nf">maplist</span><span class="p">(</span><span class="s-Atom">head</span><span class="p">,</span> <span class="nv">M</span><span class="p">,</span> <span class="nv">Hs</span><span class="p">),</span> <span class="nf">maplist</span><span class="p">(</span><span class="s-Atom">tail</span><span class="p">,</span> <span class="nv">M</span><span class="p">,</span> <span class="nv">Ts</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">transpose</span><span class="p">(</span><span class="nv">Ts</span><span class="p">,</span> <span class="nv">M1</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% simple utility predicates used in transpose</span>
</span><span class='line'><span class="nf">head</span><span class="p">([</span><span class="nv">H</span><span class="p">|</span><span class="k">_</span><span class="p">],</span> <span class="nv">H</span><span class="p">).</span>
</span><span class='line'><span class="nf">tail</span><span class="p">([</span><span class="k">_</span><span class="p">|</span><span class="nv">T</span><span class="p">],</span> <span class="nv">T</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% make_var makes a list of variables</span>
</span><span class='line'><span class="nf">make_var</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">L</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">length</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="nv">N</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% take up to N element from F, return them as P. The rest is returned as S</span>
</span><span class='line'><span class="nf">take</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">F</span><span class="p">,</span> <span class="nv">P</span><span class="p">,</span> <span class="nv">S</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">length</span><span class="p">(</span><span class="nv">F</span><span class="p">,</span> <span class="nv">Fl</span><span class="p">),</span> <span class="nv">Sl</span> <span class="o">is</span> <span class="nf">min</span><span class="p">(</span><span class="nv">Fl</span><span class="p">,</span> <span class="nv">N</span><span class="p">),</span> <span class="nf">make_var</span><span class="p">(</span><span class="nv">Sl</span><span class="p">,</span> <span class="nv">P</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">append</span><span class="p">(</span><span class="nv">P</span><span class="p">,</span> <span class="nv">S</span><span class="p">,</span> <span class="nv">F</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% split a list into sublists of N elements</span>
</span><span class='line'><span class="nf">chunk</span><span class="p">(</span><span class="k">_</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]).</span>
</span><span class='line'><span class="nf">chunk</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="p">[</span><span class="nv">L</span><span class="p">|</span><span class="nv">Ls</span><span class="p">],</span> <span class="p">[</span><span class="nv">H</span><span class="p">|</span><span class="nv">R</span><span class="p">])</span> <span class="p">:-</span> <span class="nf">take</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="p">[</span><span class="nv">L</span><span class="p">|</span><span class="nv">Ls</span><span class="p">],</span> <span class="nv">H</span><span class="p">,</span> <span class="nv">R1</span><span class="p">),</span> <span class="nf">chunk</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">R1</span><span class="p">,</span> <span class="nv">R</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% concatenate a list of list. Unlike flatten, only operate on one level</span>
</span><span class='line'><span class="nf">concatenate</span><span class="p">([],</span> <span class="nv">A</span><span class="p">,</span> <span class="nv">A</span><span class="p">).</span>
</span><span class='line'><span class="nf">concatenate</span><span class="p">([</span><span class="nv">H</span><span class="p">|</span><span class="nv">T</span><span class="p">],</span> <span class="nv">R</span><span class="p">,</span> <span class="nv">A</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">append</span><span class="p">(</span><span class="nv">H</span><span class="p">,</span> <span class="nv">A</span><span class="p">,</span> <span class="nv">A1</span><span class="p">),</span> <span class="nf">concatenate</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">R</span><span class="p">,</span> <span class="nv">A1</span><span class="p">).</span>
</span><span class='line'><span class="nf">concatenate</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="nv">R</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">concatenate</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="nv">R</span><span class="p">,</span> <span class="p">[]).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% make a list of N Char</span>
</span><span class='line'><span class="nf">const</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="nv">N</span><span class="p">).</span>
</span><span class='line'><span class="nf">make_line</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">Char</span><span class="p">,</span> <span class="nv">Out</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">make_var</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">In</span><span class="p">),</span> <span class="nf">maplist</span><span class="p">(</span><span class="nf">const</span><span class="p">(</span><span class="nv">Char</span><span class="p">),</span> <span class="nv">In</span><span class="p">,</span> <span class="nv">Out</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% make a list with values 1 to N</span>
</span><span class='line'><span class="nf">make_range</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">R</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">make_var</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">L</span><span class="p">),</span> <span class="nf">maplistidx</span><span class="p">(</span><span class="s-Atom">const</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="nv">L</span><span class="p">,</span> <span class="nv">R</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% print_line print each element in a list without list formatting</span>
</span><span class='line'><span class="nf">print_list</span><span class="p">(</span><span class="nv">List</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">maplist_</span><span class="p">(</span><span class="s-Atom">write</span><span class="p">,</span> <span class="nv">List</span><span class="p">).</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>maplist</code> is just the same as the <code>map</code> function found in many functional programming language.</p>

<figure class='code'><figcaption><span>maplist: apply sort to each sublist in a list  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">maplist</span><span class="p">(</span><span class="s-Atom">sort</span><span class="p">,</span> <span class="p">[[</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">],</span> <span class="p">[</span><span class="m">7</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">8</span><span class="p">],</span> <span class="p">[</span><span class="m">6</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">]],</span> <span class="nv">O</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nv">O</span> <span class="o">=</span> <span class="p">[[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">],[</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">],[</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">]]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>maplist_</code> is the same, but called only for side effects.</p>

<figure class='code'><figcaption><span>maplist_: output each element  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">maplist_</span><span class="p">(</span><span class="s-Atom">print</span><span class="p">,</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">]).</span>
</span><span class='line'><span class="m">123</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">true</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>maplistidx</code> is the same as <code>maplist</code> again, but additionally passes the index (position within the list) to the predicate.</p>

<figure class='code'><figcaption><span>maplistidx  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">maplistidx</span><span class="p">(</span><span class="s-Atom">const</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="p">[</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">],</span> <span class="nv">O</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nv">O</span> <span class="o">=</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>subtract</code> generalizes <code>delete</code>: it removes all the elements of a list from another one.</p>

<figure class='code'><figcaption><span>subtract  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">subtract</span><span class="p">([</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">],</span> <span class="p">[</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">],</span> <span class="nv">O</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nv">O</span> <span class="o">=</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>transpose</code> is a matrix transposition predicate. It uses <code>head</code> and <code>tail</code> to split a list.</p>

<figure class='code'><figcaption><span>transpose  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">transpose</span><span class="p">([[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">],</span> <span class="p">[</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">]],</span> <span class="nv">O</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nv">O</span> <span class="o">=</span> <span class="p">[[</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">],[</span><span class="m">2</span><span class="p">,</span><span class="m">5</span><span class="p">],[</span><span class="m">3</span><span class="p">,</span><span class="m">6</span><span class="p">]]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>make_var</code> makes a list of <code>N</code> vars</p>

<figure class='code'><figcaption><span>make_var  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">make_var</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="nv">L</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nv">L</span> <span class="o">=</span> <span class="p">[</span><span class="k">_</span><span class="p">,</span><span class="k">_</span><span class="p">,</span><span class="k">_</span><span class="p">,</span><span class="k">_</span><span class="p">,</span><span class="k">_</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">yes</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>take</code> is similar to the <code>take</code> function in Haskell: it split a list in two, the prefix being up to <code>N</code> elements long.</p>

<figure class='code'><figcaption><span>take  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">take</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">],</span> <span class="nv">T</span><span class="p">,</span> <span class="nv">R</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nv">R</span> <span class="o">=</span> <span class="p">[</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">]</span>
</span><span class='line'><span class="nv">T</span> <span class="o">=</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">yes</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>chunk</code> splits a list into chunks of size <code>N</code>.</p>

<figure class='code'><figcaption><span>chunk  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">chunk</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">],</span> <span class="nv">O</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nv">O</span> <span class="o">=</span> <span class="p">[[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">],[</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">],[</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">]]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>make_line</code> create a list of length <code>N</code>, and set each element to <code>Char</code>.</p>

<figure class='code'><figcaption><span>make_line: creating and printing a line of &#8216;-&#8217;  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">make_line</span><span class="p">(</span><span class="m">20</span><span class="p">,</span> <span class="s-Atom">&#39;-&#39;</span><span class="p">,</span> <span class="nv">O</span><span class="p">),</span> <span class="nf">maplist_</span><span class="p">(</span><span class="s-Atom">print</span><span class="p">,</span> <span class="nv">O</span><span class="p">),</span> <span class="s-Atom">nl</span><span class="p">.</span>
</span><span class='line'><span class="s-Atom">--------------------</span>
</span><span class='line'>
</span><span class='line'><span class="nv">O</span> <span class="o">=</span> <span class="p">[</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">,</span><span class="s-Atom">-</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, <code>make_range</code> creates a list with elements ranging from 1 to <code>N</code></p>

<figure class='code'><figcaption><span>make_range  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">make_range</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="nv">L</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nv">L</span> <span class="o">=</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Pretty printing Sudoku solutions</h3>

<figure class='code'><figcaption><span>Pretty Printing Sudoku  (sudoku_print.pl)</span> <a href='/downloads/code/7l7w/prolog/sudoku_print.pl'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="nf">sudoku_print</span><span class="p">(</span><span class="nv">Board</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">length</span><span class="p">(</span><span class="nv">Board</span><span class="p">,</span> <span class="nv">LB</span><span class="p">),</span>          <span class="c1">% complete board length</span>
</span><span class='line'>    <span class="nv">LL</span> <span class="o">is</span> <span class="nf">floor</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="nv">LB</span><span class="p">)),</span>      <span class="c1">% a line length is the square root of board length</span>
</span><span class='line'>    <span class="nv">SL</span> <span class="o">is</span> <span class="nf">floor</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="nv">LL</span><span class="p">)),</span>      <span class="c1">% a square length is the square root of line length</span>
</span><span class='line'>    <span class="nf">sudoku_print_</span><span class="p">(</span><span class="nv">LL</span><span class="p">,</span> <span class="nv">SL</span><span class="p">,</span> <span class="nv">SL</span><span class="p">,</span> <span class="nv">Board</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">% assuming values up to 9. Otherwise would need to</span>
</span><span class='line'><span class="c1">% configure cell width.</span>
</span><span class='line'><span class="nf">sudoku_print_</span><span class="p">(</span><span class="nv">LL</span><span class="p">,</span> <span class="nv">SH</span><span class="p">,</span> <span class="nv">SV</span><span class="p">,</span> <span class="nv">Board</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">chunk</span><span class="p">(</span><span class="nv">LL</span><span class="p">,</span> <span class="nv">Board</span><span class="p">,</span> <span class="nv">Lines</span><span class="p">),</span>             <span class="c1">% cut the board in lines</span>
</span><span class='line'>    <span class="nf">maplist</span><span class="p">(</span><span class="nf">chunk</span><span class="p">(</span><span class="nv">SH</span><span class="p">),</span> <span class="nv">Lines</span><span class="p">,</span> <span class="nv">LSquares</span><span class="p">),</span> <span class="c1">% cut each line in squares</span>
</span><span class='line'>    <span class="nf">chunk</span><span class="p">(</span><span class="nv">SV</span><span class="p">,</span> <span class="nv">LSquares</span><span class="p">,</span> <span class="nv">Squares</span><span class="p">),</span>        <span class="c1">% group each SV lines</span>
</span><span class='line'>    <span class="nv">SepL</span> <span class="o">is</span> <span class="p">(</span><span class="m">2</span> <span class="o">*</span> <span class="nv">LL</span><span class="p">)</span> <span class="o">+</span> <span class="nf">round</span><span class="p">(</span><span class="nv">LL</span><span class="o">/</span><span class="nv">SH</span><span class="p">)</span> <span class="o">+</span> <span class="m">1</span><span class="p">,</span> <span class="c1">% 2 spaces for each number</span>
</span><span class='line'>    <span class="nf">make_line</span><span class="p">(</span><span class="nv">SepL</span><span class="p">,</span> <span class="s-Atom">&#39;-&#39;</span><span class="p">,</span> <span class="nv">Line</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">print_list</span><span class="p">(</span><span class="nv">Line</span><span class="p">),</span> <span class="s-Atom">nl</span><span class="p">,</span>
</span><span class='line'>    <span class="nf">maplist_</span><span class="p">(</span><span class="nf">out_squares</span><span class="p">(</span><span class="nv">Line</span><span class="p">),</span> <span class="nv">Squares</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">out_squares</span><span class="p">(</span><span class="nv">LineSep</span><span class="p">,</span> <span class="nv">SBlock</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">maplist_</span><span class="p">(</span><span class="s-Atom">in_squares</span><span class="p">,</span> <span class="nv">SBlock</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">print_list</span><span class="p">(</span><span class="nv">LineSep</span><span class="p">),</span> <span class="s-Atom">nl</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nf">in_squares</span><span class="p">(</span><span class="nv">Line</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">write</span><span class="p">(</span><span class="s-Atom">&#39;|&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">maplist_</span><span class="p">(</span><span class="s-Atom">line</span><span class="p">,</span> <span class="nv">Line</span><span class="p">),</span><span class="s-Atom">nl</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nf">line</span><span class="p">(</span><span class="nv">SubLine</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">maplist_</span><span class="p">(</span><span class="s-Atom">print_number</span><span class="p">,</span> <span class="nv">SubLine</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">write</span><span class="p">(</span><span class="s-Atom">&#39;|&#39;</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">print_number</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">format</span><span class="p">(</span><span class="s2">&quot;~k &quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">N</span><span class="p">]).</span>
</span></code></pre></td></tr></table></div></figure>


<p>First, a test to show what the output looks like:</p>

<figure class='code'><figcaption><span>Sudoku Pretty Printer  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="nv">GNU</span> <span class="nv">Prolog</span> <span class="m">1</span><span class="p">.</span><span class="m">4</span><span class="p">.</span><span class="m">0</span>
</span><span class='line'><span class="nv">By</span> <span class="nv">Daniel</span> <span class="nv">Diaz</span>
</span><span class='line'><span class="nv">Copyright</span> <span class="p">(</span><span class="nv">C</span><span class="p">)</span> <span class="m">1999</span><span class="o">-</span><span class="m">2011</span> <span class="nv">Daniel</span> <span class="nv">Diaz</span>
</span><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">consult</span><span class="p">(</span><span class="s-Atom">&#39;utils&#39;</span><span class="p">).</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>
</span><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">consult</span><span class="p">(</span><span class="s-Atom">&#39;sudoku_book&#39;</span><span class="p">).</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>
</span><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">consult</span><span class="p">(</span><span class="s-Atom">&#39;sudoku_print&#39;</span><span class="p">).</span>
</span><span class='line'><span class="p">....</span>
</span><span class='line'>
</span><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">sudoku</span><span class="p">([</span><span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span>
</span><span class='line'>        <span class="m">3</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="m">5</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span>
</span><span class='line'>        <span class="m">4</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">],</span>
</span><span class='line'>       <span class="nv">Solution</span><span class="p">),</span> <span class="nf">sudoku_print</span><span class="p">(</span><span class="nv">Solution</span><span class="p">).</span>
</span><span class='line'><span class="s-Atom">----------------------</span>
</span><span class='line'><span class="p">|</span><span class="m">8</span> <span class="m">5</span> <span class="m">4</span> <span class="p">|</span><span class="m">2</span> <span class="m">1</span> <span class="m">9</span> <span class="p">|</span><span class="m">7</span> <span class="m">6</span> <span class="m">3</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">3</span> <span class="m">9</span> <span class="m">7</span> <span class="p">|</span><span class="m">8</span> <span class="m">6</span> <span class="m">5</span> <span class="p">|</span><span class="m">4</span> <span class="m">2</span> <span class="m">1</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">2</span> <span class="m">6</span> <span class="m">1</span> <span class="p">|</span><span class="m">4</span> <span class="m">7</span> <span class="m">3</span> <span class="p">|</span><span class="m">9</span> <span class="m">8</span> <span class="m">5</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">----------------------</span>
</span><span class='line'><span class="p">|</span><span class="m">7</span> <span class="m">8</span> <span class="m">5</span> <span class="p">|</span><span class="m">1</span> <span class="m">2</span> <span class="m">6</span> <span class="p">|</span><span class="m">3</span> <span class="m">9</span> <span class="m">4</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">6</span> <span class="m">4</span> <span class="m">9</span> <span class="p">|</span><span class="m">5</span> <span class="m">3</span> <span class="m">8</span> <span class="p">|</span><span class="m">1</span> <span class="m">7</span> <span class="m">2</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">1</span> <span class="m">3</span> <span class="m">2</span> <span class="p">|</span><span class="m">9</span> <span class="m">4</span> <span class="m">7</span> <span class="p">|</span><span class="m">8</span> <span class="m">5</span> <span class="m">6</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">----------------------</span>
</span><span class='line'><span class="p">|</span><span class="m">9</span> <span class="m">2</span> <span class="m">6</span> <span class="p">|</span><span class="m">3</span> <span class="m">8</span> <span class="m">4</span> <span class="p">|</span><span class="m">5</span> <span class="m">1</span> <span class="m">7</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">5</span> <span class="m">1</span> <span class="m">3</span> <span class="p">|</span><span class="m">7</span> <span class="m">9</span> <span class="m">2</span> <span class="p">|</span><span class="m">6</span> <span class="m">4</span> <span class="m">8</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">4</span> <span class="m">7</span> <span class="m">8</span> <span class="p">|</span><span class="m">6</span> <span class="m">5</span> <span class="m">1</span> <span class="p">|</span><span class="m">2</span> <span class="m">3</span> <span class="m">9</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">----------------------</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Solution</span> <span class="o">=</span> <span class="p">[</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">]</span> <span class="s-Atom">?</span>
</span></code></pre></td></tr></table></div></figure>


<p>First the various modules have to be loaded (GNU Prolog does not have a module system, so this is tedious). Then the solver is run on a hard problem (from <a href="http://www.sudoku.ws/hard.htm">this</a> site), and finally pretty printed. As usual, Prolog then lists the variables introduced in the query, here only <code>Solution</code>.</p>

<p>Pretty printing a 6x6 (dummy) board works as well:</p>

<figure class='code'><figcaption><span>A 6x6 board  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">make_line</span><span class="p">(</span><span class="m">36</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="nv">L</span><span class="p">),</span> <span class="nf">sudoku_print_</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="nv">L</span><span class="p">).</span>
</span><span class='line'><span class="s-Atom">---------------</span>
</span><span class='line'><span class="p">|</span><span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="p">|</span><span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="p">|</span><span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">---------------</span>
</span><span class='line'><span class="p">|</span><span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="p">|</span><span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="p">|</span><span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">---------------</span>
</span><span class='line'><span class="p">|</span><span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="p">|</span><span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="p">|</span><span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">---------------</span>
</span><span class='line'>
</span><span class='line'><span class="nv">L</span> <span class="o">=</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code is fairly simple; the major difficulty is to find names for the various segments that are printed.</p>

<p><code>sudoku_print</code> computes some parameters using assumptions that are valid for some board sizes, but not all. <code>sudoku_print_</code> should be used for these other sizes. The paramaters are the number of columns or rows <code>LL</code> and the size of the subdivisions, horizontally <code>SH</code>, and vertically <code>SV</code>.</p>

<p><code>sudoku_print_</code> then splits the <code>Board</code> into <code>LL</code> lines; each line is split into <code>SH</code> long segments (which will form the squares); and the list of lines is split into <code>SV</code> long vertical segments. A <code>LineSep</code> as large as the board: counting 2 characters per value, <code>2*LL</code>, plus 1 character for each separation before, between and after subdivisions (each subdivision is <code>SH</code> long, so there are <code>LL/SH</code> subdivisions). That <code>LineSep</code> is first printed (the general logic is that the various predicates print the separation after their output; the calling predicate emits the separation before the output).</p>

<p><code>out_squares</code> iterates over the group of lines (each <code>SV</code> long). It prints a <code>LineSep</code> after each group.</p>

<p><code>in_squares</code> iterates over a group of lines inside a square. It prints the <code>|</code> character that begins a line.</p>

<p><code>line</code> iterates over the groups within a line. It prints the <code>|</code> after each group.</p>

<p>Finally, <code>print_number</code> iterate over each number inside a group. It prints the number, then a space.</p>

<h3>The n Queens problem</h3>

<p>Here I depart from the book, as the code below solves the n Queens problem (that is, it is general over the number of queens), and I do not use the Finite Domain predicates, so as to show how Prolog can constrain the search tree.</p>

<p>The constraints on a n Queens problems are easy:</p>

<ul>
<li>no two queens on the same row</li>
<li>no two queens on the same column</li>
<li>no two queens on the same diagonal</li>
</ul>


<p>The first constraint it easy to ensure: the solution is the list of rows, each one giving the position of a single queen in that row. In other words, by the nature of the format for the solution, it is already impossible to have two queens in the same row.</p>

<p>For instance, the (dummy and wrong) board solution</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[1,3,2]</span></code></pre></td></tr></table></div></figure>


<p>puts one queen in column 1 of row 1, one queen in column 3 of row 2, and one queen in column 2 of row 3.</p>

<p>With such the board, the design of the algorithm starts to emerge:</p>

<ul>
<li>select a column for each row top to bottom,</li>
<li>for each row, know the columns selected for rows above it</li>
<li>use the selected columns to filter out the potential candidate columns for the current row</li>
<li>if no candidate exists, backtrack</li>
<li>if all rows have a column, emit the result</li>
</ul>


<figure class='code'><figcaption><span>n Queens Solver  (queens.pl)</span> <a href='/downloads/code/7l7w/prolog/queens.pl'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="c1">%% Solver predicates </span>
</span><span class='line'>
</span><span class='line'><span class="nf">exclude_diag</span><span class="p">(</span><span class="k">_</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]).</span>
</span><span class='line'><span class="nf">exclude_diag</span><span class="p">(</span><span class="nv">Diff</span><span class="p">,</span> <span class="p">[</span><span class="nv">X</span><span class="p">|</span><span class="nv">T</span><span class="p">],</span> <span class="p">[</span><span class="nv">L</span><span class="p">,</span> <span class="nv">R</span><span class="p">|</span> <span class="nv">RE</span><span class="p">])</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nv">L</span> <span class="o">is</span> <span class="nv">X</span> <span class="o">+</span> <span class="nv">Diff</span><span class="p">,</span>
</span><span class='line'>    <span class="nv">R</span> <span class="o">is</span> <span class="nv">X</span> <span class="o">-</span> <span class="nv">Diff</span><span class="p">,</span>
</span><span class='line'>    <span class="nv">Diff1</span> <span class="o">is</span> <span class="nv">Diff</span> <span class="o">+</span> <span class="m">1</span><span class="p">,</span>
</span><span class='line'>    <span class="nf">exclude_diag</span><span class="p">(</span><span class="nv">Diff1</span><span class="p">,</span> <span class="nv">T</span><span class="p">,</span> <span class="nv">RE</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">valid</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="nv">S</span><span class="p">,</span> <span class="nv">S</span><span class="p">).</span>
</span><span class='line'><span class="nf">valid</span><span class="p">(</span><span class="nv">Pos</span><span class="p">,</span> <span class="nv">Range</span><span class="p">,</span> <span class="nv">Sol</span><span class="p">,</span> <span class="nv">R</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">exclude_diag</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="nv">Sol</span><span class="p">,</span> <span class="nv">Excl</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">subtract</span><span class="p">(</span><span class="nv">Range</span><span class="p">,</span> <span class="nv">Excl</span><span class="p">,</span> <span class="nv">Poss</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">member</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="nv">Poss</span><span class="p">),</span>            <span class="c1">% pick one location</span>
</span><span class='line'>    <span class="nf">select</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="nv">Range</span><span class="p">,</span> <span class="nv">Rest</span><span class="p">),</span>     <span class="c1">% don&#39;t reuse it</span>
</span><span class='line'>    <span class="nv">Pos1</span> <span class="o">is</span> <span class="nv">Pos</span> <span class="o">-</span> <span class="m">1</span><span class="p">,</span>
</span><span class='line'>    <span class="nf">valid</span><span class="p">(</span><span class="nv">Pos1</span><span class="p">,</span> <span class="nv">Rest</span><span class="p">,</span> <span class="p">[</span><span class="nv">X</span><span class="p">|</span><span class="nv">Sol</span><span class="p">],</span> <span class="nv">R</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">queens</span><span class="p">(</span><span class="nv">Max</span><span class="p">,</span> <span class="nv">Sol</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">make_range</span><span class="p">(</span><span class="nv">Max</span><span class="p">,</span> <span class="nv">Range</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">make_var</span><span class="p">(</span><span class="nv">Max</span><span class="p">,</span> <span class="nv">Sol</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">valid</span><span class="p">(</span><span class="nv">Max</span><span class="p">,</span> <span class="nv">Range</span><span class="p">,</span> <span class="p">[],</span> <span class="nv">Sol</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">%% Formatting predicates</span>
</span><span class='line'>
</span><span class='line'><span class="nf">format_board</span><span class="p">(</span><span class="nv">Max</span><span class="p">,</span> <span class="nv">In</span><span class="p">,</span> <span class="nv">Out</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">maplist</span><span class="p">(</span><span class="nf">format_line</span><span class="p">(</span><span class="nv">Max</span><span class="p">),</span> <span class="nv">In</span><span class="p">,</span> <span class="nv">Out</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">put_queen</span><span class="p">(</span><span class="nv">Pos</span><span class="p">,</span> <span class="nv">Pos</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="s-Atom">&#39;Q&#39;</span><span class="p">).</span>
</span><span class='line'><span class="nf">put_queen</span><span class="p">(</span><span class="nv">P1</span><span class="p">,</span> <span class="nv">P2</span><span class="p">,</span> <span class="nv">E</span><span class="p">,</span> <span class="nv">E</span><span class="p">)</span> <span class="p">:-</span> <span class="nv">P1</span> <span class="s-Atom">\=</span> <span class="nv">P2</span><span class="p">.</span>
</span><span class='line'><span class="nf">format_line</span><span class="p">(</span><span class="nv">Max</span><span class="p">,</span> <span class="nv">Pos</span><span class="p">,</span> <span class="nv">L</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">make_line</span><span class="p">(</span><span class="nv">Max</span><span class="p">,</span> <span class="s-Atom">&#39; &#39;</span><span class="p">,</span> <span class="nv">R</span><span class="p">),</span> <span class="nv">Prev</span> <span class="o">is</span> <span class="nv">Pos</span> <span class="o">-</span> <span class="m">1</span><span class="p">,</span>
</span><span class='line'>    <span class="nf">take</span><span class="p">(</span><span class="nv">Prev</span><span class="p">,</span> <span class="nv">R</span><span class="p">,</span> <span class="nv">P</span><span class="p">,</span> <span class="p">[</span><span class="k">_</span><span class="p">|</span><span class="nv">S</span><span class="p">]),</span> <span class="nf">append</span><span class="p">(</span><span class="nv">P</span><span class="p">,</span> <span class="p">[</span><span class="s-Atom">&#39;Q&#39;</span><span class="p">|</span><span class="nv">S</span><span class="p">],</span> <span class="nv">L</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">%% Pretty Printer predicates</span>
</span><span class='line'>
</span><span class='line'><span class="nf">print_board</span><span class="p">(</span><span class="nv">B</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">length</span><span class="p">(</span><span class="nv">B</span><span class="p">,</span> <span class="nv">L</span><span class="p">),</span>
</span><span class='line'>    <span class="nv">LL</span> <span class="o">is</span> <span class="nv">L</span> <span class="o">*</span> <span class="m">2</span> <span class="o">+</span> <span class="m">1</span><span class="p">,</span>
</span><span class='line'>    <span class="nf">make_line</span><span class="p">(</span><span class="nv">LL</span><span class="p">,</span> <span class="s-Atom">&#39;-&#39;</span><span class="p">,</span> <span class="nv">LineSep</span><span class="p">),</span>
</span><span class='line'>    <span class="s-Atom">nl</span><span class="p">,</span> <span class="nf">print_list</span><span class="p">(</span><span class="nv">LineSep</span><span class="p">),</span> <span class="s-Atom">nl</span><span class="p">,</span>
</span><span class='line'>    <span class="nf">maplist_</span><span class="p">(</span><span class="nf">print_line</span><span class="p">(</span><span class="nv">LineSep</span><span class="p">),</span> <span class="nv">B</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">print_line</span><span class="p">(</span><span class="nv">LineSep</span><span class="p">,</span> <span class="nv">L</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">print</span><span class="p">(</span><span class="s-Atom">&#39;|&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">maplist_</span><span class="p">(</span><span class="s-Atom">print_square</span><span class="p">,</span> <span class="nv">L</span><span class="p">),</span> <span class="s-Atom">nl</span><span class="p">,</span>
</span><span class='line'>    <span class="nf">print_list</span><span class="p">(</span><span class="nv">LineSep</span><span class="p">),</span> <span class="s-Atom">nl</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nf">print_square</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">print</span><span class="p">(</span><span class="nv">S</span><span class="p">),</span> <span class="nf">print</span><span class="p">(</span><span class="s-Atom">&#39;|&#39;</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="c1">%% Toplevel predicate</span>
</span><span class='line'><span class="nf">run_queens</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">queens</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">S</span><span class="p">),</span> <span class="nf">format_board</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">S</span><span class="p">,</span> <span class="nv">B</span><span class="p">),</span> <span class="nf">print_board</span><span class="p">(</span><span class="nv">B</span><span class="p">).</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the utility predicates defined above, the code becomes fairly simple. It is divided into three groups:</p>

<ul>
<li>solver</li>
<li>formatting</li>
<li>pretty printer</li>
</ul>


<h4>Solver</h4>

<p>The solver is made of three predicates:</p>

<ul>
<li><code>queens/2</code></li>
<li><code>valid/4</code></li>
<li><code>exclude_diag/3</code></li>
</ul>


<p><code>queens</code> prepares the work: it generates the list of possible columns in <code>Range</code> (similar to the <code>fd_domain</code> predicate the book uses), and a list for the solutions in <code>Sol</code>. The actual solution is computed by <code>valid</code>.</p>

<p><code>valid</code> keeps a number of parameters:</p>

<ul>
<li><code>Pos</code> runs from <code>Max</code> to 0. When <code>Pos</code> is 0, it means we have a valid column for each row in <code>Sol</code>.</li>
<li><code>Range</code> is the currently available columns</li>
<li><code>Sol</code> is the columns of the queens in the rows above the current one</li>
<li>the last parameter is the actual solution. It is copied from <code>Sol</code> when <code>Pos</code> is 0.</li>
</ul>


<p>The logic to remove possible positions is the following:</p>

<ul>
<li>any selected column is removed from the <code>Range</code> for the rows below it</li>
<li>at each row, the diagonals of previous solutions is computed by <code>exclude_diag</code>, and removed from the <code>Range</code> only for the current row</li>
</ul>


<p>The <code>member(X, Poss)</code> clause is the core of the backtracking: from the list of not excluded columns, each element is selected, and then we try to fill the remaining rows by calling <code>valid</code> recursively. If there are no remaining columns, Prolog backtracks until the more recent <code>member(X, Poss)</code>. When <code>Poss</code> is exhausted, the backtracking continues up to the next most recent <code>member(X, Poss)</code>. So <code>member(X, Poss)</code> generates branching, and <code>valid</code> generally closes them (or finds a solution). The branching is limited as much as possible by the design of the solution, and <code>exclude_diag</code>.</p>

<p><code>exclude_diag</code> rely on a trick: let&#8217;s say a queen has been put on column <code>C</code> in a given column. Then on the next row, it blocks the columns <code>C+1</code> and <code>C-1</code>. On the row to the below, it blocks the columns <code>C+2</code> and <code>C-2</code>. In other words, it blocks columns left and right its own by a number equal to the distance in rows.</p>

<p>So <code>exclude_diag</code> iterates over the existing solutions, keeping track of the difference in column in <code>Diff</code>, and collects the blocked diagonals.</p>

<p>And yes, <code>exclude_diag</code> could be written with <code>maplistidx</code> and <code>flatten</code>. This is left as an exercise to the reader.</p>

<p>With the code above, it is already possible to compute solutions. Here is a partial list of the 8 Queens boards:</p>

<figure class='code'><figcaption><span>queens solver  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">queens</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="nv">Sol</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Sol</span> <span class="o">=</span> <span class="p">[</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Sol</span> <span class="o">=</span> <span class="p">[</span><span class="m">5</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">1</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Sol</span> <span class="o">=</span> <span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">1</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Sol</span> <span class="o">=</span> <span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">1</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Sol</span> <span class="o">=</span> <span class="p">[</span><span class="m">5</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Sol</span> <span class="o">=</span> <span class="p">[</span><span class="m">4</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">2</span><span class="p">]</span> <span class="s-Atom">?</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="m">3</span> <span class="s-Atom">ms</span><span class="p">)</span> <span class="s-Atom">yes</span>
</span></code></pre></td></tr></table></div></figure>


<p>and a complete list of the 4 Queens boards (there&#8217;s only two):</p>

<figure class='code'><figcaption><span>4 queens solutions  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">queens</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="nv">Sol</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Sol</span> <span class="o">=</span> <span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="s-Atom">a</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Sol</span> <span class="o">=</span> <span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Formatting Predicates</h4>

<p>The formatting predicates simply replace the basic solution with a list of lists, each representing a line of the board. Each cell is either a space for empty, or a &#8216;Q&#8217; character for a queen.</p>

<p>There are 2 predicates:</p>

<ul>
<li><code>format_board/3</code></li>
<li><code>format_line/3</code></li>
</ul>


<p><code>format_board</code> applies <code>format_line</code> to each column.</p>

<p><code>format_line</code> make a empty line, then split it to insert the &#8216;Q&#8217; at the right location.</p>

<h4>Pretty Printer</h4>

<p>The pretty printer predicates follow pretty much the same strategy as the pretty printer for Sudoku boards above.</p>

<p>There are 3 predicates:</p>

<ul>
<li><code>print_board/1</code></li>
<li><code>print_line/2</code></li>
<li><code>print_squares/1</code></li>
</ul>


<p>As the design is the same as the Sudoku pretty printer, it is not repeated here.</p>

<h4>Computing and printing solutions</h4>

<p>Finally, <code>run_queens</code> provide a top level predicate that computes then render each solution board. Here are the two boards from the 4 Queens problem:</p>

<figure class='code'><figcaption><span>4 Queens boards  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">run_queens</span><span class="p">(</span><span class="m">4</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">---------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">---------</span>
</span><span class='line'><span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">---------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span>
</span><span class='line'><span class="s-Atom">---------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">---------</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">true</span> <span class="s-Atom">?</span> <span class="s-Atom">a</span>
</span><span class='line'><span class="s-Atom">---------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">---------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span>
</span><span class='line'><span class="s-Atom">---------</span>
</span><span class='line'><span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">---------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">---------</span>
</span><span class='line'>
</span><span class='line'><span class="nf">true</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="m">1</span> <span class="s-Atom">ms</span><span class="p">)</span> <span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<p>and the first two boards from the 8 Queens problem:</p>

<figure class='code'><figcaption><span>8 Queens - first 2 boards  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">run_queens</span><span class="p">(</span><span class="m">8</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">true</span> <span class="s-Atom">?</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'><span class="p">|</span><span class="nv">Q</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------------</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">true</span> <span class="s-Atom">?</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="m">2</span> <span class="s-Atom">ms</span><span class="p">)</span> <span class="s-Atom">yes</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Wrapping up n Queens problem</h4>

<p>Given suitable utility predicates, the code to solve the n Queens problem (rather than just the 8 Queens problem) <em>without</em> the dedicated Finite Domain predicates is actually very short (slightly more than half is the formatting and pretty printer code).</p>

<p>The trick is to identify the best location for branching (the <code>member(X, Poss)</code> in <code>validate</code> above), and making sure the branching is as pruned as possible.</p>

<p>Prolog supports many other tricks (such at the cut <code>!</code> operator) to further constrain the search tree; and of course the availability of Finite Domain extensions add expressivity and power to an already powerful base.</p>

<h3>Improving Sudoku</h3>

<p>The code above is tied to the size of the board, and the list of constrains has to be written by hand (or using code outside Prolog). It does not have to be this way.</p>

<p>Using techniques similar to the n Queens solver, and a judicious combination of utility predicates, the list of constrains can be abstracted over.</p>

<figure class='code'><figcaption><span>Flexible Sudoku  (sudoku.pl)</span> <a href='/downloads/code/7l7w/prolog/sudoku.pl'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="nf">sudoku</span><span class="p">(</span><span class="nv">Puzzle</span><span class="p">,</span> <span class="nv">Solution</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nv">Solution</span> <span class="o">=</span> <span class="nv">Puzzle</span><span class="p">,</span>
</span><span class='line'>    <span class="nf">length</span><span class="p">(</span><span class="nv">Solution</span><span class="p">,</span> <span class="nv">Len</span><span class="p">),</span>
</span><span class='line'>    <span class="nv">Side</span> <span class="o">is</span> <span class="nf">floor</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="nv">Len</span><span class="p">)),</span>   <span class="c1">% side of the board</span>
</span><span class='line'>    <span class="nv">SH</span> <span class="o">is</span> <span class="nf">floor</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="nv">Side</span><span class="p">)),</span>    <span class="c1">% horizontal length of a Square</span>
</span><span class='line'>    <span class="nv">SV</span> <span class="o">is</span> <span class="nf">floor</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="nv">Side</span><span class="p">)),</span>    <span class="c1">% vertical length of a Square</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">sudoku_</span><span class="p">(</span><span class="nv">Len</span><span class="p">,</span> <span class="nv">Side</span><span class="p">,</span> <span class="nv">SH</span><span class="p">,</span> <span class="nv">SV</span><span class="p">,</span> <span class="nv">Puzzle</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">sudoku_</span><span class="p">(</span><span class="nv">Len</span><span class="p">,</span> <span class="nv">Side</span><span class="p">,</span> <span class="nv">SH</span><span class="p">,</span> <span class="nv">SV</span><span class="p">,</span> <span class="nv">Puzzle</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">make_var</span><span class="p">(</span><span class="nv">Len</span><span class="p">,</span> <span class="nv">Puzzle</span><span class="p">),</span>      <span class="c1">% create the Puzzle list </span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">fd_domain</span><span class="p">(</span><span class="nv">Puzzle</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="nv">Side</span><span class="p">),</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">chunk</span><span class="p">(</span><span class="nv">Side</span><span class="p">,</span> <span class="nv">Puzzle</span><span class="p">,</span> <span class="nv">Cols</span><span class="p">),</span>  <span class="c1">% split the Puzzle into columns</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">transpose</span><span class="p">(</span><span class="nv">Cols</span><span class="p">,</span> <span class="nv">Rows</span><span class="p">),</span>      <span class="c1">% transpose the columns into rows</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">make_squares</span><span class="p">(</span><span class="nv">SH</span><span class="p">,</span> <span class="nv">SV</span><span class="p">,</span> <span class="nv">Cols</span><span class="p">,</span> <span class="nv">Squares</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">concatenate</span><span class="p">([</span><span class="nv">Cols</span><span class="p">,</span> <span class="nv">Rows</span><span class="p">,</span> <span class="nv">Squares</span><span class="p">],</span> <span class="nv">Constrains</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">valid</span><span class="p">(</span><span class="nv">Constrains</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">fd_labeling</span><span class="p">(</span><span class="nv">Puzzle</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">valid</span><span class="p">([]).</span>
</span><span class='line'><span class="nf">valid</span><span class="p">([</span><span class="nv">Head</span><span class="p">|</span><span class="nv">Tail</span><span class="p">])</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">fd_all_different</span><span class="p">(</span><span class="nv">Head</span><span class="p">),</span>
</span><span class='line'>    <span class="nf">valid</span><span class="p">(</span><span class="nv">Tail</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">make_squares</span><span class="p">(</span><span class="nv">SH</span><span class="p">,</span> <span class="nv">SV</span><span class="p">,</span> <span class="nv">Cols</span><span class="p">,</span> <span class="nv">Squares</span><span class="p">)</span> <span class="p">:-</span>
</span><span class='line'>    <span class="nf">maplist</span><span class="p">(</span><span class="nf">chunk</span><span class="p">(</span><span class="nv">SH</span><span class="p">),</span> <span class="nv">Cols</span><span class="p">,</span> <span class="nv">ColSplit</span><span class="p">),</span> <span class="c1">% split each line into SH long segments</span>
</span><span class='line'>    <span class="nf">transpose</span><span class="p">(</span><span class="nv">ColSplit</span><span class="p">,</span> <span class="nv">RowSplit</span><span class="p">),</span> <span class="c1">% transpose the result to process columns</span>
</span><span class='line'>    <span class="nf">maplist</span><span class="p">(</span><span class="nf">chunk</span><span class="p">(</span><span class="nv">SV</span><span class="p">),</span> <span class="nv">RowSplit</span><span class="p">,</span> <span class="nv">ListOfListOfSquares</span><span class="p">),</span> <span class="c1">% split each column into SV long segments</span>
</span><span class='line'>    <span class="nf">maplist</span><span class="p">(</span><span class="nf">maplist</span><span class="p">(</span><span class="s-Atom">concatenate</span><span class="p">),</span> <span class="nv">ListOfListOfSquares</span><span class="p">,</span> <span class="nv">ListOfSquares</span><span class="p">),</span> <span class="c1">% group the squares together into each column </span>
</span><span class='line'>    <span class="nf">concatenate</span><span class="p">(</span><span class="nv">ListOfSquares</span><span class="p">,</span> <span class="nv">Squares</span><span class="p">).</span> <span class="c1">% group all the columns together, so at to have a list of squares</span>
</span></code></pre></td></tr></table></div></figure>


<p>The new code is about the size of the original 4x4 Sudoku code from the book, and clearly shorter than the 9x9 Sudoku code above. Of course it hides some or the complexity in utility predicates, but that&#8217;s what libraries are for.</p>

<p>Now the Sudoku solver can be used on the old 4x4 problem:</p>

<figure class='code'><figcaption><span>Testing new Sudoku solver on 4x4 problem  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="nv">GNU</span> <span class="nv">Prolog</span> <span class="m">1</span><span class="p">.</span><span class="m">4</span><span class="p">.</span><span class="m">0</span>
</span><span class='line'><span class="nv">By</span> <span class="nv">Daniel</span> <span class="nv">Diaz</span>
</span><span class='line'><span class="nv">Copyright</span> <span class="p">(</span><span class="nv">C</span><span class="p">)</span> <span class="m">1999</span><span class="o">-</span><span class="m">2011</span> <span class="nv">Daniel</span> <span class="nv">Diaz</span>
</span><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">consult</span><span class="p">(</span><span class="s-Atom">&#39;utils&#39;</span><span class="p">).</span>
</span><span class='line'><span class="p">....</span>
</span><span class='line'>
</span><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">consult</span><span class="p">(</span><span class="s-Atom">&#39;sudoku&#39;</span><span class="p">).</span>
</span><span class='line'><span class="p">....</span>
</span><span class='line'>
</span><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">consult</span><span class="p">(</span><span class="s-Atom">&#39;sudoku_print&#39;</span><span class="p">).</span>
</span><span class='line'><span class="p">....</span>
</span><span class='line'>
</span><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">sudoku</span><span class="p">([</span><span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span>
</span><span class='line'>             <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>             <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>             <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">],</span>
</span><span class='line'>             <span class="nv">Solution</span><span class="p">),</span> <span class="nf">sudoku_print</span><span class="p">(</span><span class="nv">Solution</span><span class="p">).</span>
</span><span class='line'><span class="s-Atom">-----------</span>
</span><span class='line'><span class="p">|</span><span class="m">4</span> <span class="m">1</span> <span class="p">|</span><span class="m">2</span> <span class="m">3</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">2</span> <span class="m">3</span> <span class="p">|</span><span class="m">4</span> <span class="m">1</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------</span>
</span><span class='line'><span class="p">|</span><span class="m">1</span> <span class="m">2</span> <span class="p">|</span><span class="m">3</span> <span class="m">4</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">3</span> <span class="m">4</span> <span class="p">|</span><span class="m">1</span> <span class="m">2</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">-----------</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Solution</span> <span class="o">=</span> <span class="p">[</span><span class="m">4</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="s-Atom">a</span>
</span><span class='line'>
</span><span class='line'><span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<p>as well as on 8x8 (hard) problems:</p>

<figure class='code'><figcaption><span>Testing new Sudoku solver on 8x8 problem  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='prolog'><span class='line'><span class="p">|</span> <span class="s-Atom">?-</span> <span class="nf">sudoku</span><span class="p">([</span><span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span>
</span><span class='line'>        <span class="m">3</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="k">_</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span>
</span><span class='line'>        <span class="m">5</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span>
</span><span class='line'>        <span class="m">4</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">],</span>
</span><span class='line'>       <span class="nv">Solution</span><span class="p">),</span> <span class="nf">sudoku_print</span><span class="p">(</span><span class="nv">Solution</span><span class="p">).</span>
</span><span class='line'><span class="s-Atom">----------------------</span>
</span><span class='line'><span class="p">|</span><span class="m">8</span> <span class="m">5</span> <span class="m">4</span> <span class="p">|</span><span class="m">2</span> <span class="m">1</span> <span class="m">9</span> <span class="p">|</span><span class="m">7</span> <span class="m">6</span> <span class="m">3</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">3</span> <span class="m">9</span> <span class="m">7</span> <span class="p">|</span><span class="m">8</span> <span class="m">6</span> <span class="m">5</span> <span class="p">|</span><span class="m">4</span> <span class="m">2</span> <span class="m">1</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">2</span> <span class="m">6</span> <span class="m">1</span> <span class="p">|</span><span class="m">4</span> <span class="m">7</span> <span class="m">3</span> <span class="p">|</span><span class="m">9</span> <span class="m">8</span> <span class="m">5</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">----------------------</span>
</span><span class='line'><span class="p">|</span><span class="m">7</span> <span class="m">8</span> <span class="m">5</span> <span class="p">|</span><span class="m">1</span> <span class="m">2</span> <span class="m">6</span> <span class="p">|</span><span class="m">3</span> <span class="m">9</span> <span class="m">4</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">6</span> <span class="m">4</span> <span class="m">9</span> <span class="p">|</span><span class="m">5</span> <span class="m">3</span> <span class="m">8</span> <span class="p">|</span><span class="m">1</span> <span class="m">7</span> <span class="m">2</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">1</span> <span class="m">3</span> <span class="m">2</span> <span class="p">|</span><span class="m">9</span> <span class="m">4</span> <span class="m">7</span> <span class="p">|</span><span class="m">8</span> <span class="m">5</span> <span class="m">6</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">----------------------</span>
</span><span class='line'><span class="p">|</span><span class="m">9</span> <span class="m">2</span> <span class="m">6</span> <span class="p">|</span><span class="m">3</span> <span class="m">8</span> <span class="m">4</span> <span class="p">|</span><span class="m">5</span> <span class="m">1</span> <span class="m">7</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">5</span> <span class="m">1</span> <span class="m">3</span> <span class="p">|</span><span class="m">7</span> <span class="m">9</span> <span class="m">2</span> <span class="p">|</span><span class="m">6</span> <span class="m">4</span> <span class="m">8</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span><span class="m">4</span> <span class="m">7</span> <span class="m">8</span> <span class="p">|</span><span class="m">6</span> <span class="m">5</span> <span class="m">1</span> <span class="p">|</span><span class="m">2</span> <span class="m">3</span> <span class="m">9</span> <span class="p">|</span>
</span><span class='line'><span class="s-Atom">----------------------</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Solution</span> <span class="o">=</span> <span class="p">[</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">9</span><span class="p">]</span> <span class="s-Atom">?</span> <span class="nf">a</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="m">1</span> <span class="s-Atom">ms</span><span class="p">)</span> <span class="s-Atom">no</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Wrapping Day 3 and Prolog</h2>

<p>I really enjoyed coding in Prolog again. Backtracking is a powerful mechanism which allows clear and concise descriptions of some problems. And I can feel that there is yet a more interesting language lurking just beyond my current understanding.</p>

<p>The book gives a fair account of Prolog strengths and weaknesses. While I see little to no use for it in my daily activities, I wished my copy of &#8220;The Art of Prolog&#8221; was not on another continent.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Frédéric Dumont</span></span>

      








  


<time datetime="2011-10-24T13:33:00+09:00" pubdate data-updated="true">Oct 24<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/books/'>Books</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://blog.wakatta.jp/blog/2011/10/24/seven-languages-in-seven-weeks-prolog-day-3/" data-via="" data-counturl="http://blog.wakatta.jp/blog/2011/10/24/seven-languages-in-seven-weeks-prolog-day-3/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/10/23/seven-languages-in-seven-weeks-prolog-day-2/" title="Previous Post: Seven Languages in Seven Weeks Prolog Day 2">&laquo; Seven Languages in Seven Weeks Prolog Day 2</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/10/25/it-has-been-a-bad-year-for-geniuses-dot-dot-dot/" title="next Post: It has been a bad year for geniuses...">It has been a bad year for geniuses... &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Wakatta!</h1>
  <p>
		<a href="/about">more...</a>
	</p>
</section>

<section>
	<h1>Seven Languages in Seven Weeks Series</h1>
	
		<ul>
		
			<li class="post"><a href="/blog/2011/10/11/seven-languages-in-seven-weeks/">Intro</a></li>
		
			<li class="post"><a href="/blog/2011/10/11/seven-languages-in-seven-weeks-ruby-day-1/">Ruby Day 1</a></li>
		
			<li class="post"><a href="/blog/2011/10/12/seven-languages-in-seven-weeks-ruby-day-2/">Ruby Day 2</a></li>
		
			<li class="post"><a href="/blog/2011/10/13/seven-languages-in-seven-weeks-ruby-day-3/">Ruby Day 3</a></li>
		
			<li class="post"><a href="/blog/2011/10/18/seven-languages-in-seven-weeks-io-day-1/">Io Day 1</a></li>
		
			<li class="post"><a href="/blog/2011/10/19/seven-languages-in-seven-weeks-io-day-2/">Io Day 2</a></li>
		
			<li class="post"><a href="/blog/2011/10/20/seven-languages-in-seven-weeks-io-day-3/">Io Day 3</a></li>
		
			<li class="post"><a href="/blog/2011/10/21/seven-languages-in-seven-weeks-about-io/">About Io</a></li>
		
			<li class="post"><a href="/blog/2011/10/23/seven-languages-in-seven-weeks-prolog-day-1/">Prolog Day 1</a></li>
		
			<li class="post"><a href="/blog/2011/10/23/seven-languages-in-seven-weeks-prolog-day-2/">Prolog Day 2</a></li>
		
			<li class="post"><a href="/blog/2011/10/24/seven-languages-in-seven-weeks-prolog-day-3/">Prolog Day 3</a></li>
		
			<li class="post"><a href="/blog/2011/10/28/seven-languages-in-seven-weeks-scala-day-1/">Scala Day 1</a></li>
		
			<li class="post"><a href="/blog/2011/10/29/seven-languages-in-seven-weeks-scala-day-2/">Scala Day 2</a></li>
		
			<li class="post"><a href="/blog/2011/10/30/seven-languages-in-seven-weeks-scala-day-3/">Scala Day 3</a></li>
		
			<li class="post"><a href="/blog/2011/11/04/seven-languages-in-seven-weeks-erlang-day-1/">Erlang Day 1</a></li>
		
			<li class="post"><a href="/blog/2011/11/05/seven-languages-in-seven-weeks-erlang-day-2/">Erlang Day 2</a></li>
		
			<li class="post"><a href="/blog/2011/11/06/seven-languages-in-seven-weeks-erlang-day-3/">Erlang Day 3</a></li>
		
			<li class="post"><a href="/blog/2011/11/11/seven-languages-in-seven-weeks-clojure-day-1/">Clojure Day 1</a></li>
		
			<li class="post"><a href="/blog/2011/11/12/seven-languages-in-seven-weeks-clojure-day-2/">Clojure Day 2</a></li>
		
			<li class="post"><a href="/blog/2011/11/17/seven-languages-in-seven-weeks-haskell-day-1/">Haskell Day 1</a></li>
		
			<li class="post"><a href="/blog/2011/11/18/seven-languages-in-seven-weeks-haskell-day-2/">Haskell Day 2</a></li>
		
		</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/11/18/seven-languages-in-seven-weeks-haskell-day-2/">Seven Languages in Seven Weeks Haskell Day 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/17/seven-languages-in-seven-weeks-haskell-day-1/">Seven Languages in Seven Weeks Haskell Day 1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/13/seven-languages-in-seven-weeks-clojure-day-3/">Seven Languages in Seven Weeks Clojure Day 3</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/12/seven-languages-in-seven-weeks-clojure-day-2/">Seven Languages in Seven Weeks Clojure Day 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/11/haskell-foldr-as-foldl/">Haskell: foldr as foldl</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/fdumontmd">@fdumontmd</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'fdumontmd',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Frédéric Dumont -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'wakatta-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.wakatta.jp/blog/2011/10/24/seven-languages-in-seven-weeks-prolog-day-3/';
        var disqus_url = 'http://blog.wakatta.jp/blog/2011/10/24/seven-languages-in-seven-weeks-prolog-day-3/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
